(()=>{function e(e){return e&&e.__esModule?e.default:e}var t=function(e){return e.replace(/_/g,":")},i=/(\/b|\/s|\/l).*(node=)(\d{1,12})/,n=new Map,a=function(){if(!n.has(window.location.href)){var e=i.exec(window.location.href),t=e&&e[3]?e[3]:null;n.set(window.location.href,t)}return n.get(window.location.href)},o=function(e){var t=a();if(!e||!t)return null;var i=e.split(":");return i.splice(i.length-1,0,t),i.join(":")},s=function(e){var t=a();return t?"".concat(e,":").concat(t):null},r={wb:"ues",bb:"uet",af:"uet",cf:"uet",be:"uet",ld:"uex"},d=function(e){var i,n,a=e.latencyEvent,r=e.scope,d=e.placement,p=e.timestamp;l(a)&&(c(a,m(r),d.id,p),c(a,m(r),t(d.name),p),c(a,m(r),null!==(i=o(d.name))&&void 0!==i?i:void 0,p),c(a,m(r),null!==(n=s(d.id))&&void 0!==n?n:void 0,p))},l=function(e){return"function"==typeof window[r[e]]},c=function(e,t,i,n){void 0===n&&(n=new Date);var a=r[e];i&&"function"==typeof window[a]&&window[a](e,t+i,{wb:1},n)},m=function(e){return"adplacements:"+p(e)},p=function(e){return e?"".concat(e,":"):""},h=function(e){console.debug(e)},u=function(e,t){console.error(e),f("ERROR",e,v(e,t))},w=function(e,t){console.error(e),f("FATAL",e,v(e,t))},f=function(e,t,i){var n;null===(n=window.ueLogError)||void 0===n||n.call(window,i,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},v=function(e,t){return t instanceof Error?t:t?new Error(t):new Error(e)},g=function(e,t,i){if(window.csa)try{window.csa("Content",{element:e})("mark",t,null==i?void 0:i.getTime())}catch(n){u("Error with 'mark' CSA",n)}};class y{sendLatencyMetric({latencyMetricType:e,placementId:t,placementName:i,placementDivId:n,timestamp:a}){d({latencyEvent:e.csmKey,scope:e.csmMessage,placement:{id:t,name:i},timestamp:a}),g(document.getElementById(n),e.csaKey,a)}}const b=()=>new y;var I=function(e,t,i){if(""===t)throw new Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));var n=new URL(e),a=n.searchParams.get(t),o=a||"{}",s=JSON.parse(o),r=Object.assign(s,i);return n.searchParams.set(t,JSON.stringify(r)),n.toString()};function S(e,t,i){var n,a=i||{},o=a.noTrailing,s=void 0!==o&&o,r=a.noLeading,d=void 0!==r&&r,l=a.debounceMode,c=void 0===l?void 0:l,m=!1,p=0;function h(){n&&clearTimeout(n)}function u(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];var r=this,l=Date.now()-p;function u(){p=Date.now(),t.apply(r,a)}function w(){n=void 0}m||(d||!c||n||u(),h(),void 0===c&&l>e?d?(p=Date.now(),s||(n=setTimeout(c?w:u,e))):u():!0!==s&&(n=setTimeout(c?w:u,void 0===c?e-l:e)))}return u.cancel=function(e){var t=(e||{}).upcomingOnly,i=void 0!==t&&t;h(),m=!i},u}const A="com.amazon.ads.cpp.",E=(e,t)=>`${A}${e}.${t}`;class T{*[Symbol.iterator](){for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);if(null==t?void 0:t.startsWith(A)){const i=localStorage.getItem(t);if(localStorage.removeItem(t),e=-1,null===i)continue;yield[t,i]}}}}const M=(e,t,i)=>{localStorage.setItem(E(e,t),i)},k=(e,t,i)=>(...n)=>{try{e(...n)}catch(a){null==t||t(i||"Error in handler",a)}},D=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/,x=e=>D.test(e),L=e=>x(e)?N(e):e,C=e=>x(e)?e:z(e),z=e=>btoa(unescape(encodeURIComponent(e))),N=e=>decodeURIComponent(escape(atob(e))),_=e=>e&&0===Object.keys(e).length&&e.constructor===Object,R=e=>{return t=e.slotName,["mobile-auto-top-advertising-0","auto-top-advertising-0"].includes(t)?e.renderingId:e.placementName;var t};var H=function(e,i,n){var a,r,d,l,c,m;if(void 0===n&&(n=1),!W())return window.safeframe=null!==(a=window.safeframe)&&void 0!==a?a:{},window.safeframe.csmCache=null!==(r=window.safeframe.csmCache)&&void 0!==r?r:{},window.safeframe.csmCache.incrementCsmPlacementCounter=null!==(d=window.safeframe.csmCache.incrementCsmPlacementCounter)&&void 0!==d?d:[],void window.safeframe.csmCache.incrementCsmPlacementCounter.push({metric:e,placement:i,count:n});null===(m=null===(c=null===(l=window.safeframe)||void 0===l?void 0:l.csmCache)||void 0===c?void 0:c.incrementCsmPlacementCounter)||void 0===m||m.forEach((function(e){return H(e.metric,e.placement,e.count)}));var p=function(e,t,i){t&&$("".concat(O(e),":").concat(t),i)};p(e,i.id,n),p(e,s(i.id),n),p(e,t(i.name),n),p(e,o(t(i.name)),n)},F=function(e,t){var i,n,a,o,s,r;if(void 0===t&&(t=1),!W())return window.safeframe=null!==(i=window.safeframe)&&void 0!==i?i:{},window.safeframe.csmCache=null!==(n=window.safeframe.csmCache)&&void 0!==n?n:{},window.safeframe.csmCache.incrementCsmCounter=null!==(a=window.safeframe.csmCache.incrementCsmCounter)&&void 0!==a?a:[],void window.safeframe.csmCache.incrementCsmCounter.push({metric:e,count:t});null===(r=null===(s=null===(o=window.safeframe)||void 0===o?void 0:o.csmCache)||void 0===s?void 0:s.incrementCsmCounter)||void 0===r||r.forEach((function(e){return F(e.metric,e.count)})),$(O(e),t)},W=function(){var e;return"function"==typeof(null===(e=null===window||void 0===window?void 0:window.ue)||void 0===e?void 0:e.count)},$=function(e,t){var i;return null===(i=null===window||void 0===window?void 0:window.ue)||void 0===i?void 0:i.count(e,t)},B="adplacements",O=function(e){return e.startsWith(B)?e:"".concat(B,":").concat(e)};const U=(e,t)=>{const i=e,n=i[t].options;if(_(i))return F("getiframe:admap:empty"),null;if(_(n))return F("getiframe:addetails:empty"),null;i[t]&&!_(i[t])||F("getiframe:admap:adinfo:undefinedorempty");const a=`ape_${R(n)}_iframe`;var o,s;i[t].iframe?(null===(s=i[t])||void 0===s||null===(o=s.iframe)||void 0===o?void 0:o.innerHTML)?F("getiframe:admap:iframe:innerhtml:exist"):(F("getiframe:admap:iframe:innerhtml:undefined"),i[t].iframe=document.getElementById(a),document.getElementById(a)||F("getiframe:getElementById:undefined")):F("getiframe:admap:iframe:undefined");return i[t].iframe},q=[{p:50,t:2,def:"iab"}],j=[{p:0,t:0,def:"amzn"},{p:50,t:1,def:"iab"},{p:100,t:1,def:"groupm"}],V=[{p:0,t:0,def:"amzn"},{p:30,t:1,def:"iab"},{p:100,t:1,def:"groupm"}],J=()=>window.innerHeight||document.documentElement.clientHeight,Y=()=>window.innerWidth||document.documentElement.clientWidth,X=e=>e.getBoundingClientRect().top-J(),K=(e,t)=>({t:e.top,l:e.left,r:e.right,b:e.bottom,w:e.width,h:e.height,z:t}),G=e=>{const t=e.getBoundingClientRect();return K(t,Number(window.getComputedStyle(e,null).zIndex))},Z=e=>{const t=ne(e);return{t:e.t,l:e.l,r:e.r,b:e.b,w:e.w,h:e.h,z:e.z,xiv:t.xiv,yiv:t.yiv,iv:t.iv}},Q=()=>{const e=window.screenY?window.screenY:window.screenTop,t=window.screenX?window.screenX:window.screenLeft,i=Y(),n=J();return{t:e,l:t,w:i,h:n,b:e+n,r:t+i}},ee=e=>{const t=Q(),i=(e=>Z(G(e)))(e),n=ae(e);return{atf:te(e),geom:{win:t,self:i,exp:n},payload:{wh:t.h,ww:t.w,sx:window.scrollX,sy:window.scrollY,ah:i.h,aw:i.w,top:i.t,left:i.l}}},te=e=>{const t=function(e){const t=document.body.getBoundingClientRect();if(ie(t))return null;const i=G(e),n=J(),a=Y(),o=Math.max(0,Math.min(t.left+a,i.r)-i.l),s=Math.max(0,Math.min(t.top+n,i.b)-i.t),r=o*s/(i.h*Math.min(i.w,a));return Number(Math.min(1,Math.max(0,r)).toFixed(2))}(e);return null==t?"unknown":t>=.5},ie=e=>0===e.width&&0===e.height;const ne=e=>{const t=Y(),i=J(),n=Math.max(0,re(e.t,e.b,i)),a=Math.max(0,re(e.l,e.r,t)),o=n*a,s=e.h*Math.min(e.w,t);return 0!==s||0!==o?{xiv:Number(Math.min(1,a/e.w).toFixed(2)),yiv:Number(Math.min(1,n/e.h).toFixed(2)),iv:Number(Math.min(1,Math.max(0,o/s)).toFixed(2))}:{xiv:0,yiv:0,iv:0}},ae=e=>{const t=e.getBoundingClientRect();return oe(t)},oe=e=>({t:e.top,l:e.left,r:Y()-e.right,b:J()-e.bottom,xs:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth)>Y()?1:0,yx:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)>J()?1:0}),se=e=>oe(e),re=(e,t,i)=>{let n=0;return"visible"!==document.visibilityState?n:(n=e>0?i-e:t>0?Math.min(t,i):0,Math.min(n,t-e))},de=(e,t)=>{const i=G(e),n=G(t),a=Y(),o=J();return i&&n&&(Math.abs(i.t-n.b)<o||Math.abs(i.b-n.t)<o)&&(Math.abs(i.l-n.r)<a||Math.abs(i.r-n.l)<a)},le=(e,t)=>{const i=parseInt(t.height)*parseInt(t.width)>=242500;return"V"===e?q:i?V:j},ce=e=>{const t=me(e),i=Q(),n=Z(K(t,NaN));return{atf:"unknown",geom:{win:i,self:n,exp:se(t)},payload:{wh:i.h,ww:i.w,sx:window.scrollX,sy:window.scrollY,ah:n.h,aw:n.w,top:n.t,left:n.l}}},me=e=>{const t=e.initialBoundingRect,i=t.top-(window.scrollY-e.originalScrollY),n=i+e.adHeight,a=t.left-(window.scrollX-e.originalScrollX);return{top:i,bottom:n,left:a,right:a+e.adWidth,width:e.adWidth,height:e.adHeight}},pe="btr_client",he="cod_client",ue="localstorage_impression",we=(e,t)=>{const i=document.createElement("img");return i.id=e,i.style.display="none",i.setAttribute("pixel-url",t),i},fe="localstorage:impression",ve=async(e,t)=>{let i,n;return new Promise((a=>{n=a,i=new IntersectionObserver((t=>{t.forEach((t=>{t.target===e&&t.isIntersecting&&(n(t),i.unobserve(e))}))}),t),i.observe(e)}))};var ge;ge=function(e){try{var t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(n){return!1}};const ye="sfImpression",be="LightAdImpression",Ie="viewablelatency",Se=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i}),Ae=Se("bodyBegin","bb",ye),Ee=(Se("bodyBegin","bb",be),Se("bodyEnd","be"),Se("clickToATF","af"),Se("criticalFeature","cf"),Se("criticalFeature","cf",ye),Se("criticalFeature","cf",be),Se("loaded","ld"),Se("loaded","ld",ye),Se("loaded","ld",be),Se("viewablelatency:bodyBegin","bb",Ie)),Te=Se("viewablelatency:loaded","ld",Ie),Me=e=>null==e?void 0:e.replace("criticalFeature","").replace("windowOnLoad","").replace("spATFEvent","").replace("r2OnLoad","").replace("aboveTheFold","").replace("af",""),ke=e=>{const t=Me(e);return""===t||"immediate"===t},De=async(e,t)=>{e=Me(null!=e?e:"");const i="undefined"!=typeof P,n=/^reached(\d{1,5}px)FromTop$/g.exec(e);if(!ke(e)){if(e.match("[^:]+:.+")){const t=e.split(":"),n=t[1],a=t.length>2?t[2]:n;if(i)return await new Promise((e=>P.when(a,"A").execute(e)));throw new Error("Need AUI or AmazonJQ installed")}return e.match(/^\d{1,4}px$/g)?await Pe(parseInt(e,10),t,((e,t)=>{const i=X(e);return e&&i<=t})):n?await Pe(parseInt(n[1],10),t,xe):void u(`Unknown delay pattern ${e}`)}},xe=(e,t)=>window.scrollY+J()>=t,Pe=async(e,t,i)=>new Promise((n=>{const a=()=>{i(t,e)&&(n(),window.removeEventListener("scroll",o),window.removeEventListener("resize",o))},o=k(S(20,(()=>{a()})),u);window.addEventListener("scroll",o),window.addEventListener("resize",o),a()})),Le=(e,t,i,n,a,o)=>{const s=null==e?void 0:e[t];(null==s?void 0:s.valid)&&(s.loaded=!0,s.viewed&&(b().sendLatencyMetric({latencyMetricType:Te,placementId:n,placementName:i,placementDivId:a,timestamp:new Date(o)}),H("htmlviewed:loaded",{id:n,name:i})))},Ce=e=>{window.addEventListener("scroll",e),window.addEventListener("resize",e),document.addEventListener("visibilitychange",e)};var ze=function(e){if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("setEntity",{adCreativeMetaData:e})}catch(t){u("Error with 'setEntity' CSA",t)}},Ne=function(e,t,i){if(void 0===i&&(i=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e+":"+t.name+":"+t.id,metricValue:i},{ent:"all"})}catch(n){u("Error with 'logCsaEvent' CSA",n)}},_e=function(e,t){if(void 0===t&&(t=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e,metricValue:t},{ent:"all"})}catch(i){u("Error with 'incrementCounter' CSA",i)}};const Re=async(e,t,i,n)=>{i.options.firePixelsAfter&&await De(i.options.firePixelsAfter,i.placement),await Oe(t.adMap,i.options.arid),e.sendMessageToAd(i.options.arid,"fireImpression",n),We(e,t,i,n.isNoInventory)},He=async(e,t,i,n)=>{i.options.firePixelsAfter&&await De(i.options.firePixelsAfter,i.placement),await Oe(t.adMap,i.options.arid),n.measurementMethod===pe&&e.sendMessageToAd(i.options.arid,"fireImpression",{measurementMethod:pe,isNoInventory:n.isNoInventory}),We(e,t,i,n.isNoInventory)},Fe=async(e,t)=>{t.options.firePixelsAfter&&await De(t.options.firePixelsAfter,t.placement),e.sendMessageToAd(t.options.arid,"fireImpression",{measurementMethod:he,isNoInventory:!1})},We=(e,t,i,n)=>{n?Be(e,t,i):$e(e,t,i)},$e=(e,t,i)=>{Ue(e,t.adMap,i.options.arid);const n=t.ADS_HANDLERS[i.options.arid];n.viewabilityTracker=()=>{S(50,Ue)(e,t.adMap,i.options.arid)},Ce(n.viewabilityTracker);new IntersectionObserver((()=>{Ue(e,t.adMap,i.options.arid)}),{threshold:[0,.5,1]}).observe(i.placement)},Be=(e,t,i)=>{const n=je(t.adMap,i.options.arid);t.adMap[i.options.arid].noInventorySlotSnapshot=n,qe(e,t.adMap,i.options.arid,n),e.sendMessageToAd(i.options.arid,"handleFallbackBehavior",{});const a=t.ADS_HANDLERS[i.options.arid];a.noInventoryViewabilityTracker=()=>{S(20,qe)(e,t.adMap,i.options.arid,n)},Ce(a.noInventoryViewabilityTracker)},Oe=async(e,t)=>{const i=U(e,t),n={root:document.documentElement};await ve(i,n)},Ue=(e,t,i)=>{const n=t[i].options,a=U(t,i),o=le(n.mediaType,n.size);if(a){const t=ee(a);t.viewabilityStandards=o,e.sendMessageToAd(i,"updateViewability",t)}},qe=(e,t,i,n)=>{const a=t[i].options,o=le(a.mediaType,a.size),s=ce(n);s.viewabilityStandards=o,e.sendMessageToAd(i,"updateViewability",s)},je=(e,t)=>{const i=U(e,t);return{initialBoundingRect:(n=i).getBoundingClientRect(),adHeight:n.offsetHeight,adWidth:n.offsetWidth,originalScrollX:window.scrollX,originalScrollY:window.scrollY};var n},Ve=e=>{try{Ye(e,document.body),F(fe,1),_e(ue)}catch(t){F("localstorage:error",1),_e("localstorage_error")}},Je=()=>{if(e(ge)("localStorage"))for(const e of new T){const t=e[1];Ve(t)}},Ye=async(e,t)=>{const i=I(e,"pj",{measurementMethod:he});try{await fetch(i,{keepalive:!0,mode:"no-cors",priority:"low"}),t.appendChild(we("ape_impression",i)),F(fe+"loaded"),_e(ue+"loaded")}catch(n){throw F(fe+"error"),_e(ue+"error"),n}F("impressionFired")},Xe=e=>!e||Ke(e)||Ge(e)?e:e+"px",Ke=e=>e.length>1&&"%"===e.charAt(e.length-1),Ge=e=>e.length>2&&"px"===e.substring(e.length-2),Ze=e=>Ke(e)?e:`${parseInt(e)}px`;const Qe=(e,t)=>{for(const i of Object.keys(t))e.style[i]=t[i];return e},et=(e,t,i,n,a,o)=>{try{var s;const r=nt(e,o),d=at(e,o)||r,l=ot(e,o);if(null===d||null===r||null===l)return void u("Unable to find wrapper, placement, or safe frame iframe",new Error("resizeSafeFrameAd error"));const c=Ke(i),m=Ke(t),p=!m&&!c,h=parseInt(t,10);let w=m?l.offsetWidth:h,f=c?l.offsetHeight:parseInt(i,10);const v=parseInt(n,10),g=e=>{p&&(f=st({height:f,width:w,targetWidth:e})),w=Math.round(e)},y=0===d.offsetWidth?Y():d.offsetWidth;v&&J()<Y()?g(v):g(y);const b=null==a||null===(s=a.adMap[e])||void 0===s?void 0:s.noInventorySlotSnapshot;b&&(b.adHeight=f,b.adWidth=w);const I=Xe(w),S=Xe(p?f:i);if(l.style.height=S,l.style.width=I,d!==r){r.style.height=S;const t={width:I,height:S};a.sendMessageToAd(e,"resizeCreativeWrapper",t)}"Detail_hero-quick-promo_Desktop"===o[e].slotId&&(H("OffsetLeft",{id:a.adMap[e].options.placementId,name:o[e].slotId},l.offsetLeft),H("OffsetTop",{id:a.adMap[e].options.placementId,name:o[e].slotId},l.offsetTop),H("OffsetWidth",{id:a.adMap[e].options.placementId,name:o[e].slotId},l.offsetWidth),H("OffsetHeight",{id:a.adMap[e].options.placementId,name:o[e].slotId},l.offsetHeight))}catch(r){u("Error resizing ad: "+o[e].slotId,r)}},tt=(e,t,i)=>{const n=at(e,t)||nt(e,t),a=ot(e,t),o=i.resizePlacementStyleAboveThreshold,s=i.resizePlacementStyleBelowThreshold,r=parseInt(i.resizePlacementWidthThreshold,10);n&&a&&r&&o&&s?n.offsetWidth<r?Qe(a,s):Qe(a,o):u("Missing arguments in setResizePlacementStyle",new Error("setResizePlacementStyle error"))},it=(e,t)=>{const i=document.getElementById(e.adUnitIframeId);i.style.height=Xe(t),i.style.zIndex="2",i.style.position="relative"},nt=(e,t)=>document.getElementById(t[e].placementDivId),at=(e,t)=>{var i;return(null===(i=t[e])||void 0===i?void 0:i.wrapperDivId)?document.getElementById(t[e].wrapperDivId):null},ot=(e,t)=>document.getElementById(t[e].iframeId),st=({height:e,width:t,targetWidth:i})=>0===t||isNaN(e)||isNaN(t)||isNaN(i)?0:Math.round(i*e/t),rt=(e,t)=>{e&&(e.style.height=Xe(t))};class dt{constructor(e,t){this.weblabsWindow=e,this.prefix=t,this.isT1=()=>"t1"===this.weblabTreatment(),this.isT2=()=>"t2"===this.weblabTreatment(),this.isT3=()=>"t3"===this.weblabTreatment(),this.isT4=()=>"t4"===this.weblabTreatment(),this.isT5=()=>"t5"===this.weblabTreatment(),this.weblabTreatment=()=>{var e,t,i;return null===(i=this.weblabsWindow)||void 0===i||null===(t=i.renderingWeblabs)||void 0===t||null===(e=t[this.prefix])||void 0===e?void 0:e.toLowerCase()}}}const lt=()=>new dt(window,"ADPT_SF_TRANSPARENCY_INFO_MANDATORY_FOR_EU_712921"),ct=()=>new dt(window,"ADPT_SF_RESIZE_ASPECT_RATIO_909226"),mt=(e,t)=>{const i=new Set(["bf4ab3db-618a-4853-ae89-3ad3bd17df16","dd4c5e61-fe9a-4d91-9deb-25fa60557719","da326e4a-90bd-4da3-a526-53301eb2c6a0","ca609359-3cb9-4984-8830-231c22e978d3","15554fd8-4c3e-45c6-ae61-84c65966f5d1","1396c5b8-45a1-4618-9a09-0b84209807f9","d9fb239d-fcde-414f-98a8-409c81052388","b60ea84b-3e24-44dc-9fdb-35bb2fb1fe5c","75b4c7aa-4c22-49d3-8371-15ca116eaf1f","ef368293-2611-4cef-8050-4fcd9b97f12e","db5cbac6-5194-4b52-9929-9ec0bbfed990","6479c6f3-a9c2-4d7c-9d1a-45008113fe0c"]);new dt(window,"A2I_HOMEPAGE_CARD_THEMING_360311").isT1()&&i.has(e)&&(t&&(t.style.background="linear-gradient(to right, #28C8F0, #71CDFE, #34A8F1)"),t&&(t.style.margin="0px"))};class pt{resize(e){var t;if(!this.isAllowedSize(e))return void u(`Size w:'${e.width}', h:'${e.height}' is not allow-listed for '${this.name}'`);const i=this.wrapperDiv,n=this.div,a=this.safeframe;null==i||i.removeAttribute("style"),i&&(i.style.overflow="hidden"),i&&(i.style.backgroundColor="white"),n.removeAttribute("style"),n.style.lineHeight="0",!i&&(n.style.marginBottom="20px"),n.style.marginLeft="auto",n.style.marginRight="auto",n.style.maxHeight="inherit",n.style.maxWidth=i?"min(100vh, 100vw)":"inherit",n.style.position="relative",a.style.height="100%",a.style.width="100%",a.removeAttribute("height"),a.removeAttribute("width"),a.style.removeProperty("min-width"),a.style.removeProperty("max-height"),a.style.removeProperty("padding-bottom"),null===(t=this.card)||void 0===t||t.style.setProperty("padding","0"),Ke(e.height)||Ke(e.width)?(n.style.height=Ze(e.height),n.style.width=Ze(e.width)):n.style.aspectRatio=`${parseInt(e.width)} / ${parseInt(e.height)}`,this.resizeHandleSpecialCases(e),mt(this.id,this.wrapperDiv)}collapse(){this.wrapperDiv&&(this.wrapperDiv.style.display="none"),this.div.style.display="none"}resizeHandleSpecialCases(e){const t=this.div;if(wt(this.slotName,e))t.style.maxWidth=Ze(e.width);else if(ut(this.slotName)){var i;const e=this.wrapperDiv;null==e||e.style.setProperty("width","100vw"),null==e||e.style.setProperty("margin-left","calc(-50vw + 50%)"),t.style.removeProperty("aspect-ratio"),t.style.removeProperty("max-width"),t.style.height="50px",null===(i=t.closest(".a-container"))||void 0===i||i.style.setProperty("padding-top","0")}else if(ht(this.slotName)){t.style.removeProperty("aspect-ratio"),t.style.removeProperty("max-width"),t.style.height="55px",t.style.width="100vw",t.style.marginLeft="calc(-50vw + 50%)";const e=document.createElement("style");e.innerHTML=`#${t.id}_Feedback { margin-right: 10px; }`,t.prepend(e)}else"alm-morrisons-storefront-desktop-ad-1"!==this.slotName&&"alm-morrisons-storefront-desktop-ad-2"!==this.slotName&&"alm-monoprix-storefront-desktop-ad-1"!==this.slotName&&"alm-monoprix-storefront-desktop-ad-2"!==this.slotName&&"alm-dia-storefront-desktop-ad-1"!==this.slotName&&"alm-dia-storefront-desktop-ad-2"!==this.slotName&&"alm-storefront-desktop-ad-1"!==this.slotName&&"alm-storefront-desktop-ad-2"!==this.slotName&&"alm-wfm-storefront-desktop-ad-1"!==this.slotName&&"alm-wfm-storefront-desktop-ad-2"!==this.slotName||(this.div.style.maxWidth="300px",this.div.style.marginTop="47px",this.div.style.removeProperty("margin-left"),this.div.style.removeProperty("margin-right"))}get wrapperDiv(){return this.wrapperDivId?document.getElementById(this.wrapperDivId):null}get div(){return document.getElementById(this.divId)}get safeframe(){return document.getElementById(this.safeframeId)}get card(){return document.getElementById(`ape_${this.name}_aui_card`)}constructor(e,t,i,n,a,o,s){this.id=e,this.name=t,this.wrapperDivId=i,this.divId=n,this.safeframeId=a,this.slotName=o,this.allowedSizes=s,this.isAllowedSize=e=>this.allowedSizes.some((t=>Ze(e.height)===t.height&&Ze(e.width)===t.width))}}const ht=e=>"desktop-detail-ilm"===e||"fresh-desktop-detail-ilm"===e||"wfm-desktop-detail-ilm"===e||"vindp-desktop-atf-ilm"===e,ut=e=>"mobile-detail-ilm"===e||"mobile-app-detail-ilm"===e||"fresh-mobile-detail-ilm"===e||"fresh-mobile-detail-ilm-v1"===e||"wfm-mobile-detail-ilm-v1"===e,wt=(e,t)=>970===parseInt(t.width)||980===parseInt(t.width)||728===parseInt(t.width)||"merchandised-search-top-1"===e||"merchandised-search-7"===e||"gwm-atf-dashboard"===e,ft=e=>vt(e,[]),vt=(e,t)=>{var i;return new pt(e.placementId,e.placementName,e.adUnitWrapperId,e.adUnitPlacementId,e.adUnitIframeId,e.slotName,(null!==(i=e.allowedSizes)&&void 0!==i?i:[]).concat({height:Ze(e.size.height),width:Ze(e.size.width)}).concat(t.map((e=>({height:Ze(e.height),width:Ze(e.width)})))))},gt="expanded-feedback-label",yt="expanded-safeframe",bt="expandable-ads-styles",It=(e,t,i)=>{const n=Dt(t,ft(e.options).div.offsetWidth),a={height:Xe(n),width:Xe(e.options.size.width)},o=vt(e.options,[a]);o.resize(a),kt(e.options),Et(e.options),o.div.style.height=a.height,xt(e,i,At)},St=(e,t,i)=>{const n=ft(e.options).div.offsetHeight;It(e,t,i);const a=ft(e.options);a.div.style.zIndex="2",a.div.style.position="relative",a.div.parentElement&&a.div.parentElement.style.removeProperty("overflow"),a.div.parentElement&&(a.div.parentElement.style.height=n+"px")},At=e=>{ft(e.options).resize(e.options.size),Mt(e.options)},Et=e=>{const t=document.getElementById(e.adUnitIframeId),i=Tt(t);if(null===i||null===t)throw new Error(`feedbackWrapper: ${i?"present":"missing"}, safeFrame: ${t?"present":"missing"}`);i.classList.add(gt),t.classList.add(yt)},Tt=e=>{if(ct().isT1()){var t;let i=null==e?void 0:e.parentElement;return(null==i||null===(t=i.parentElement)||void 0===t?void 0:t.id.endsWith("_wrapper"))&&(i=i.parentElement),i.querySelector("div[id$=_Feedback]")}return(null==e?void 0:e.parentElement).querySelector("div[id$=placement_Feedback]")},Mt=e=>{const t=document.getElementById(e.adUnitIframeId),i=Tt(t);null!==i&&null!==t&&(i.classList.remove(gt),t.classList.remove(yt))},kt=e=>{(e=>{if(null!==document.querySelector(`#${bt}`))return;const t=document.createElement("style");t.id=bt,t.innerHTML=ct().isT1()?`\n        div.${gt} {\n            background-color: white;\n            z-index: 2;\n            margin-top: 0px !important;\n            padding-top: 2px !important;\n        }`:`\n        div.${gt} {\n            background-color: white;\n            z-index: 2;\n            height: 30px !important;\n            top: 0px !important;\n        }\n        iframe.${yt} {\n            display: block;\n            padding: 0px !important;\n            max-height: none !important;\n        }`,document.getElementById(e.adUnitPlacementId).appendChild(t)})(e)},Dt=(e,t)=>(e.staticHeight?parseInt(e.staticHeight,10):0)+(Ke(e.width)?parseInt(e.height,10):st({height:parseInt(e.height,10),width:parseInt(e.width,10),targetWidth:t})),xt=(e,t,i)=>{const n=n=>{Pt(n,e,t),i(e)};window.addEventListener("scroll",n,{once:!0}),window.addEventListener("click",n,{once:!0}),window.addEventListener("swipe",n,{once:!0}),window.addEventListener("tap",n,{once:!0})},Pt=(e,t,i)=>{i.sendMessageToAd(t.options.arid,"triggerEventInIframe",{eventType:e.type})},Lt=(e,t)=>{Pt(new Event("click"),e,t)},Ct=e=>e+"_Feedback",zt=e=>Ct(e)+"_Hidden";class Nt{async addSponsoredLabelWithFeedbackLink(e,t){e.appendChildTo(this.parentHtmlId,this);const i=await t.getSponsoredLabelAndFeedbackLink(this.urlPathAndParameter);if(!(null==i?void 0:i.isOk()))throw new Error(`Result from the feedback service was not ok ${this.urlPathAndParameter}`);e.updateElement(this.getHtmlId(),i)}getHtmlId(){return Ct(this.parentHtmlId)}getHiddenHtmlId(){return zt(this.parentHtmlId)}isHidden(){return this.hidden}exists(e){return e.exists(this.getHtmlId())}constructor(e,t,i,n,a,o,s){this.parentHtmlId=e,this.feedbackStyle=t,this.labelText=i,this.labelStyle=n,this.position=a,this.urlPathAndParameter=o,this.hidden=s}}class _t{open(e){e.clickChildLink(this)}getHtmlId(){return Ct(this.parentHtmlId)}getHiddenHtmlId(){return zt(this.parentHtmlId)}constructor(e){this.parentHtmlId=e}}class Rt{async createSponsoredLabelWithFeedbackLink(e,t){if(!e.exists(this.feedbackHtmlPort)){t.request();try{await e.addSponsoredLabelWithFeedbackLink(this.feedbackHtmlPort,this.feedbackApiPort),t.success(),e.isHidden()||t.labelRenderedHost()}catch(i){throw t.error(),i}}}openModal(e){e.open(this.feedbackHtmlPort)}labelRendered(e){e.labelRenderedCreative()}removeSponsoredLabelAndFeedbackLink(e){try{var t;null===(t=document.getElementById(Ct(e)))||void 0===t||t.remove()}catch(i){u("Unable to remove AdFeedback Div",i)}}logTransparencyInfoMissing(e){e.transparencyInfoMissing()}getSponsoredLabelElement(e){return document.getElementById(`${Ct(e)}_Label`)}constructor(e,t){this.feedbackHtmlPort=e,this.feedbackApiPort=t}}const Ht=e=>new Kt(e),Ft="adfeedback_request",Wt="adfeedback_success",$t="adfeedback_error",Bt="adfeedback_sponsoredlabelrendered_creative",Ot="adfeedback_sponsoredlabelrendered_host",Ut="adfeedback:request",qt="adfeedback:success",jt="adfeedback:error",Vt="adfeedback:sponsoredlabelrendered:creative",Jt="adfeedback:sponsoredlabelrendered:host",Yt="adfeedback:sponsoredlabelrendered",Xt="adfeedback:transparencyinfo:missing";class Kt{request(){H(Ut,this.placement),F(Ut),Ne(Ft,this.placement)}success(){H(qt,this.placement),F(qt),Ne(Wt,this.placement)}error(){H(jt,this.placement),Ne($t,this.placement)}labelRenderedCreative(){H(Vt,this.placement),F(Yt),Ne(Bt,this.placement)}labelRenderedHost(){H(Jt,this.placement),F(Yt),Ne(Ot,this.placement)}transparencyInfoMissing(){H(Xt,this.placement),F(Xt)}constructor(e){this.placement=e}}class Gt{isOk(){return"ok"===this.status}constructor(e,t,i){this.status=e,this.html=t,this.script=i}}class Zt{async getSponsoredLabelAndFeedbackLink(e){const t=await fetch(this.windowRepo.origin()+e);if(t.ok){const e=await t.json();return new Gt(e.status,e.html,e.script)}throw Error("Could not fetch the feedback html/link/script/label")}constructor(e){this.windowRepo=e}}class Qt{appendChildTo(e,t){var i,n;function a(e,t){const i=document.createElement("div");return i.setAttribute("id",t.getHtmlId()),ct().isT1()?(i.style.position="relative",i.style.height="20px",i.style.textAlign=i.id.includes("hero-quick-promo_Desktop_placement_Feedback")?"left":"right",i.style.padding="0",i.style.marginTop="2px",i.style.display=t.feedbackStyle.display,e.endsWith("_wrapper")&&(!e.includes("-ilm")&&(i.style.maxWidth="min(100vh, 100vw)"),i.style.marginLeft="auto",i.style.marginRight="auto",i.style.padding="0 5px")):ei(i,t.feedbackStyle),i.append(function(e){const t=document.createElement("div");return t.innerHTML=e.labelText,ei(t,e.labelStyle),t}(t)),i}1===t.position?null===(i=document.getElementById(e))||void 0===i||i.prepend(a(e,t)):0===t.position&&(null===(n=document.getElementById(e))||void 0===n||n.append(a(e,t)))}updateElement(e,t){const i=document.getElementById(e);if(i&&(i.innerHTML=t.html,ti(i,t),ct().isT1()))for(const n of i.children)"DIV"===n.tagName?n.removeAttribute("style"):"A"===n.tagName&&(n.style.removeProperty("position"),n.style.removeProperty("top"),n.style.removeProperty("right"),n.style.removeProperty("display"))}clickChildLink(e){const t=document.getElementById(e.getHtmlId());for(const n of(null==t?void 0:t.children)||[])if("A"===(i=n).tagName||"DIV"===i.tagName)return void n.click();var i}exists(e){return!!document.getElementById(e)}appendSponsoredLabel(e,t){const i=document.getElementById(e.getHtmlId());if(!i)return void u(`Error in looking for html element ${e.getHtmlId()} to append`);i.append(((e,t)=>{const i=document.createElement("div");return i.setAttribute("id",e.getHiddenHtmlId()),ei(i,e.feedbackStyle),i.innerHTML=t.html,ti(i,t),i})(e,t))}}const ei=(e,t)=>{for(const i in t)e.style.setProperty(i,t[i])},ti=(e,t)=>{ii(e).innerHTML=t.script},ii=e=>{const t=document.createElement("script");return e.prepend(t),t},ni={code:"BE",hostname:"www.amazon.com.be",name:"Belgium"},ai={code:"FR",hostname:"www.amazon.fr",name:"France"},oi={code:"DE",hostname:"www.amazon.de",name:"Germany"},si={code:"IT",hostname:"www.amazon.it",name:"Italy"},ri={code:"NL",hostname:"www.amazon.nl",name:"Netherlands"},di={code:"PL",hostname:"www.amazon.pl",name:"Poland"},li={code:"ES",hostname:"www.amazon.es",name:"Spain"},ci={code:"SE",hostname:"www.amazon.se",name:"Sweden"},mi=e=>location.hostname===e.hostname,pi=e=>!(mi(ni)||mi(ai)||mi(oi)||mi(si)||mi(ri)||mi(di)||mi(li)||mi(ci))||hi(e),hi=e=>{var t,i,n,a,o,s;const r=[];wi(null==e||null===(n=e.url)||void 0===n||null===(i=n.parameters)||void 0===i||null===(t=i.adPlacementMetaData)||void 0===t?void 0:t.slotName)&&r.push("DSA Error: slotName missing");const d=null==e||null===(s=e.url)||void 0===s||null===(o=s.parameters)||void 0===o||null===(a=o.adCreativeMetaData)||void 0===a?void 0:a.adCreativeDetails;(!d||d.length<=0)&&r.push("DSA Error: transparency info missing"),null==d||d.every((e=>ui(e,r)));for(const l of r)for(let e=0;e<fi();e++)u(l);return r.length<=0},ui=(e,t)=>{var i,n,a,o,s;e.version||t.push("DSA Error: version missing"),wi(e.advertiserIdNS)&&t.push("DSA Error: advertiserIdNS missing"),void 0!==(null===(i=e.selectionSignals)||void 0===i?void 0:i.context)&&null!==(null===(n=e.selectionSignals)||void 0===n?void 0:n.context)||t.push("DSA Error: selectionSignals.context missing"),void 0!==(null===(a=e.selectionSignals)||void 0===a?void 0:a.location)&&null!==(null===(o=e.selectionSignals)||void 0===o?void 0:o.location)||t.push("DSA Error: selectionSignals.location missing"),wi(null===(s=e.selectionSignals)||void 0===s?void 0:s.pastActivity)&&t.push("DSA Error: selectionSignals.pastActivity missing")},wi=e=>!e||e.length<=0,fi=()=>lt().isT1()?2:lt().isT2()?4:lt().isT3()?8:lt().isT4()?16:lt().isT5()?32:1,vi=()=>new gi(new Rt(new Qt,new Zt({origin:()=>window.location.origin})));class gi{async addSponsoredLabel({parentHtmlId:e,placement:t,feedback:i}){return pi(i)?(i.hidden&&(Object.assign(i.style,{display:"none"}),Object.assign(i.label.style,{display:"none"})),await this.feedbackService.createSponsoredLabelWithFeedbackLink(yi(e,i),Ht(t)),!0):(this.feedbackService.logTransparencyInfoMissing(Ht(t)),u("Transparency Information missing"),!1)}openModal(e){this.feedbackService.openModal(new _t(e))}labelRendered({placement:e}){this.feedbackService.labelRendered(Ht(e))}removeSponsoredLabelAndFeedbackLink(e){this.feedbackService.removeSponsoredLabelAndFeedbackLink(e)}constructor(e){this.feedbackService=e}}const yi=(e,t)=>{const i=JSON.parse(JSON.stringify(t.url.parameters));return i.adPlacementMetaData.pageUrl=C(i.adPlacementMetaData.pageUrl),new Nt(e,t.style,t.label.text,t.label.style,"TOP"===t.position?1:0,(n=t.url.path,a=encodeURIComponent(JSON.stringify(i)),n+"?pl="+a),t.hidden);var n,a},bi=e=>{vi().labelRendered({placement:{id:e.options.placementId,name:e.options.placementName}})},Ii=e=>{vi().openModal(e.options.adPlacementMetaData.adElementId)},Si=e=>{vi().removeSponsoredLabelAndFeedbackLink(e.options.adPlacementMetaData.adElementId)},Ai=async e=>vi().addSponsoredLabel(Ei(e)),Ei=e=>{const t=e.adPlacementMetaData,i=e.adFeedbackInfo;var n;return{parentHtmlId:ct().isT1()?null!==(n=e.adUnitWrapperId)&&void 0!==n?n:e.adUnitPlacementId:t.adElementId,placement:{id:e.placementId,name:e.placementName},feedback:{position:i.adFeedbackOnTop?"TOP":"BOTTOM",hidden:!i.boolFeedback,style:e.feedbackDivStyle,url:{path:i.endPoint,parameters:{adPlacementMetaData:{adElementId:t.adElementId,pageType:t.pageType,pageUrl:C(t.pageUrl),slotName:t.slotName},adCreativeMetaData:e.adCreativeMetaData}},label:{text:L(i.sponsoredText),style:e.advertisementStyle}}}},Ti="gw-video-orchestrator",Mi=(e,t,i)=>{var n;null===(n=window.P)||void 0===n||n.when(Ti).execute((n=>{try{n.subscribe(e,t,i)}catch(a){a instanceof Error?h(`gw-video-orchestrator error: ${a.message}`):h(`gw-video-orchestrator error: ${a}`)}}))},ki=e=>{var t;null===(t=window.P)||void 0===t||t.when(Ti).execute((t=>{t.elect(e)}))};let Di=null;function xi(e,t,i){const n=t=>{i.sendCustomMessageToAd(e.options.arid,"videoAutoplayResponse",t)};var a;e.options.expParams&&e.options.expParams.noVideoAutoplay?n(!1):(a=e.options.pageType)&&"gateway"===a.toLowerCase()?Mi(e.iframe,n,t):Di===e.options.arid?n(!0):null===Di&&function(e){const t=document.getElementsByTagName("video");for(let i=0;i<t.length;++i)if(!t[i].paused&&de(e,t[i]))return!1;return!0}(e.iframe)?(Di=e.options.arid,n(!0)):n(!1)}function Pi(){ki(),Di=null}function Li(e){var t;t=e.iframe,ki(t),Di=e.options.arid}var Ci=function(e,i,n){zi()&&(Ni(_i(e,i.id,n)),Ni(_i(e,t(i.name),n)))},zi=function(){var e;return"function"==typeof(null===(e=null===window||void 0===window?void 0:window.ue)||void 0===e?void 0:e.tag)},Ni=function(e){var t;return null===(t=null===window||void 0===window?void 0:window.ue)||void 0===t?void 0:t.tag(e)},_i=function(e,t,i){return"".concat(e,":").concat(t).concat(Ri(i))},Ri=function(e){return e?":".concat(e):""};class Hi{constructor(t,i){this.hms=t,this.hc=i,this.changeSize=(e,t)=>{var i;if(ct().isT1()){return void ft(e.options).resize(t)}if(!e.options.allowChangeSize||Bi(e,t))return;const n=null===(i=e.options.allowedSizes)||void 0===i?void 0:i.concat(Ui(e.options.size));if(Wi(t,n)){e.iframe.style.height=t.height,e.iframe.style.width=t.width;const i=at(e.options.arid,this.hc.AD_IDS);e.placement.style.height=i?t.height:"auto",e.placement.style.width=t.width,$i(e)}else u(`Size is not allow-listed: '${t.width}' x '${t.height}' for '${e.options.placementName}'`)},this.sendAdBarTrace=(e,t)=>{e.options.arid in this.hc.AD_TRACERS&&this.hc.AD_TRACERS[e.options.arid].logTrace(t.field,t.traceInfo)},this.startPixelTracking=async(e,t)=>{await Re(this.hms,this.hc,e,t)},this.startBTRPixelTracking=async(e,t)=>{await He(this.hms,this.hc,e,t)},this.fireImpressionWithDelay=async e=>{await Fe(this.hms,e)},this.logAPIInvocation=(e,t)=>{const i=`messenger:${t.apiName}`;F(i),H(i,{id:e.options.placementId,name:e.options.placementName}),e.options.arid in this.hc.AD_TRACERS&&this.hc.AD_TRACERS[e.options.arid].logTrace("apiCalls",t)},this.resizeSafeFrameAd=async e=>{ct().isT1()||(window.addEventListener("resize",this.hc.ADS_HANDLERS[e.options.arid].defaultResizeSafeFrameHandler),et(e.options.arid,e.options.size.width,e.options.size.height,e.options.maxAdWidth,this.hms,this.hc.AD_IDS))},this.setResizePlacementStyle=async e=>{ct().isT1()||(window.addEventListener("resize",this.hc.ADS_HANDLERS[e.options.arid].defaultSetResizePlacementStyle),e.options.resizePlacementStyle&&tt(e.options.arid,this.hc.AD_IDS,e.options.resizePlacementStyle))},this.logError=(e,t)=>{u(t.message+": "+e.options.placementName,t.error)},this.logCsaEvent=(e,t)=>{Ne(t.metricName,{name:e.options.placementName,id:e.options.placementId})},this.addCsaEntity=(e,t)=>{ze(t)},this.sendLatencyMetric=(e,t)=>Fi(e,t),this.customMessage=(e,t)=>{this.hms.customMessage(t.key,t.body,["openPsAdPopover","openATCModal","setPartner","sendMetrics","wrap"],e.options.placementName,e.options.placementId)},this.fireViewableLatencyMetrics=async(e,t)=>{Le(this.hc.viewableLatencyTrackers,e.options.arid,e.options.placementName,e.options.placementId,e.options.adUnitPlacementId,t.adLoadedTimestamp)},this.countMetric=(e,t)=>{t.isGlobal?F(t.metricMsg,t.value):H(t.metricMsg,{id:e.options.placementId,name:e.options.placementName},t.value)},this.addCsmTag=(e,t)=>{var i,n;t.isGlobal?(i=t.tag,n=t.msg,zi()&&Ni(i+Ri(n))):Ci(t.tag,{id:e.options.placementId,name:e.options.placementName},t.msg)},this.requestVideoAutoplay=async(e,t)=>{xi(e,t,this.hms)},this.releaseVideoAutoplay=async()=>{Pi()},this.haveVideoAutoplayPermission=async e=>{Li(e)},this.feedbackLabelRendered=e=>{bi(e)},this.feedbackOpenModal=e=>{Ii(e)},this.handleFallbackExperience=async e=>{Si(e)},this.expandAdSlot=(e,t)=>{if(ct().isT1())return void It(e,t,this.hms);const i=e.iframe;try{const n=Dt(t,i.offsetWidth),a=Ke(t.width)?t.width:i.offsetWidth;kt(e.options),et(e.options.arid,Xe(a),Xe(n),e.options.maxAdWidth,this.hms,this.hc.AD_IDS);const o=at(e.options.arid,this.hc.AD_IDS);rt(o,Xe(n+20)),xt(e,this.hms,this.resetSlotSize)}catch(n){w("Error attempting to expand ad slot: ",n),Lt(e,this.hms),this.resetSlotSize(e)}},this.expandAdSlotWithOverlap=(e,t)=>{if(ct().isT1())return void St(e,t,this.hms);const i=e.iframe;try{const n=Dt(t,i.offsetWidth);kt(e.options),it(e.options,Xe(n)),Et(e.options),xt(e,this.hms,this.resetSlotSize)}catch(n){w("Error attempting to expand ad slot with overlap: ",n),Lt(e,this.hms),this.resetSlotSize(e)}},this.resetSlotSize=e=>{if(ct().isT1())return void At(e);const t=this.hc.ADS_HANDLERS[e.options.arid].defaultResizeSafeFrameHandler;t(),window.addEventListener("resize",S(20,t)),rt(at(e.options.arid,this.hc.AD_IDS),Xe(parseInt(e.options.size.height,10)+20)),Mt(e.options)},this.triggerEventInIframe=(e,t)=>{this.hms.sendMessageToAd(e.options.arid,"triggerEventInIframe",{eventType:t.event.type})},this.registerCODFallback=(t,i)=>{e(ge)("localStorage")&&M("SF",t.options.arid,i)},this.clearCODFallback=t=>{var i,n;e(ge)("localStorage")&&(i="SF",n=t.options.arid,localStorage.removeItem(E(i,n)))},this.safeFrameReady=e=>{var t,i;null===(i=performance)||void 0===i||null===(t=i.mark)||void 0===t||t.call(i,`SafeFrame:  safeFrameReady ${e.options.slotName}`),this.hms.sendMessageToAd(e.options.arid,"setupComputedAdDetails",{computed:{aPageStart:window.aPageStart,adStartTime:(new Date).getTime()}})},this.saveAdDetailsForAdReporter=(e,t)=>{var i;window.adReporterDetails=null!==(i=window.adReporterDetails)&&void 0!==i?i:{},window.adReporterDetails[e.options.adUnitPlacementId]=Object.assign(e.options,t)}}}const Fi=(e,{latencyMetricType:t,timestamp:i})=>{b().sendLatencyMetric({latencyMetricType:t,placementName:e.options.placementName,placementId:e.options.placementId,placementDivId:e.options.adUnitPlacementId,timestamp:i})},Wi=(e,t)=>0!==t.length&&t.some((t=>{return n=t,(i=e).height===n.height&&i.width===n.width;var i,n})),$i=e=>{e.placement.style.overflow=""},Bi=(e,t)=>e.placement.style.height===t.height&&e.placement.style.width===t.width,Oi=e=>(null==e?void 0:e.endsWith("px"))||(null==e?void 0:e.endsWith("%"))?e:`${e}px`,Ui=e=>({height:Oi(e.height),width:Oi(e.width)}),qi=e=>{const t=document.getElementById(e);void 0!==t&&t&&(t.style.display="none")};class ji extends Hi{constructor(e,t){super(e,t),this.collapseSlot=async e=>{var t,i;(qi(this.hc.AD_IDS[e.options.arid].placementDivId),qi(this.hc.AD_IDS[e.options.arid].auiCardDeckId),"nav-sitewide-msg"===e.options.slotName)&&(await De("amznJQ.available:navbarJSLoaded",e.placement),"function"==typeof(null===(i=parent)||void 0===i||null===(t=i.navbar)||void 0===t?void 0:t.unHideSWM)&&parent.navbar.unHideSWM())}}}const Vi="adload:start",Ji=e=>{const t=`@media screen and (orientation: landscape){[id=${e.parentElement.id}] { width: 100vw !important; margin-left: calc(-50vw + 50%) !important; height: 50px !important;}}@media screen and (orientation: portrait){[id=${e.parentElement.id}] {width: 100vw !important; margin-left: calc(-50vw + 50%) !important; height: 50px !important;}}`;Xi(e,t)},Yi=e=>{const t=`@media screen and (min-width: 1500px) {div[id$=${e.id}] {width: 100vw !important;height: 55px !important;margin: 0 calc(-50vw + 50%) 20px !important;}}@media screen and (max-width: 1500px) {div[id$=${e.id}_Feedback] {right: 5px !important}}`;Xi(e,t)},Xi=(e,t)=>{if(ct().isT1())return;const i=document.createElement("style");i.innerHTML=t,e.prepend(i)},Ki="nav-ewc-persistent-hover",Gi=e=>{switch(e.slotName){case"desktop-detail-ilm":case"fresh-desktop-detail-ilm":case"wfm-desktop-detail-ilm":case"vindp-desktop-atf-ilm":Qi(document.getElementById(e.adUnitPlacementId)),Yi(document.getElementById(e.adUnitPlacementId));break;case"mobile-detail-ilm":case"mobile-app-detail-ilm":case"fresh-mobile-detail-ilm":case"fresh-mobile-detail-ilm-v1":case"wfm-mobile-detail-ilm-v1":Ji(document.getElementById(e.adUnitPlacementId))}},Zi=e=>"attributes"===e.type&&"class"===e.attributeName&&e.target.classList.contains(Ki),Qi=e=>{if(null!==document.querySelector(`.${Ki}`))return void en(e);new MutationObserver(((t,i)=>{if(t.some(Zi))try{en(e),i.disconnect()}catch(n){u("Failed to resize ILM for EWC.",n)}})).observe(window.document.documentElement,{attributes:!0,attributeFilter:["class"]})},en=e=>{const t=document.querySelector("div#nav-flyout-ewc");if(null===e||null===t)return void u(`could not find placementDiv (value was: ${e}) or ewc (value was: ${t})`);const i=t.offsetWidth;tn(e,i)},tn=(e,t)=>{var i,n;const a=document.createElement("style");a.innerHTML=`@media screen and (min-width: 1500px) { div[id$=${e.id}] {\n        width: calc(100vw - ${t}px) !important; \n        margin-left: calc(-50vw + 50% + ${t/2}px) !important;\n        margin-right: calc(-50vw + 50% + ${t/2}px) !important;\n    `,null===(n=document)||void 0===n||null===(i=n.body)||void 0===i||i.appendChild(a)};class nn{start(){const e=()=>{this.sendTrace(),window.setInterval(this.sendTrace,3e3)};"loading"!==document.readyState?e():window.addEventListener("load",e)}logTrace(e,t){if(this.traceId){let i;const n=(new Date).getTime();Object.prototype.hasOwnProperty.call(this.storedTrace,e)||(this.storedTrace[e]=[]);i=t===Object(t)?Object.assign({},t):JSON.parse('{ "'+e+'":"'+t+'"}'),i.timeStamp=n,i.timeSinceAdStart=n-this.adStartTime,this.storedTrace[e].push(i)}}async sendTrace(){if(!(e=>{for(const t in e)if(Object.prototype.hasOwnProperty.call(this.storedTrace,t))return!1;return!0})(this.storedTrace)){const e="/gp/adbarplus?traceId="+this.traceId+"&systemName=browser",t=await fetch(e,{method:"POST",body:JSON.stringify(this.storedTrace),headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(t.ok)for(const i in this.storedTrace)Object.prototype.hasOwnProperty.call(this.storedTrace,i)&&delete this.storedTrace[i];else console.error("failed to send request to /gp/adbarplus",t)}}constructor(e,t=0,i={}){this.traceId=e,this.adStartTime=t,this.storedTrace=i}}const an=(e,t)=>{const{slotName:i,traceId:n,arid:a,allowedSizes:o,computed:s,abpStatus:r,loadAfter:d}=t,l=window[i],c=new nn(n,l&&l.adStartTime||0);e.AD_TRACERS[a]=c,e.AD_TRACERS[a].logTrace("safeFrameInput",t);const m={caches:window.caches,plugins:document.plugins,cookies:document.cookie,userAgents:navigator.userAgent};e.AD_TRACERS[a].logTrace("browserData",m);const p={allowedSizes:o,computed:s,adStartTime:l,abpStatus:r,loadAfter:d};e.AD_TRACERS[a].logTrace("additionalInitilizationParams",p),c.start()},on=(e,t,i)=>e>0?i>e:t>0,sn=(e,t,i,n,a,o)=>{var s,r,d;const l=null===(d=document)||void 0===d||null===(r=d.getElementById)||void 0===r||null===(s=r.call(d,i))||void 0===s?void 0:s.getBoundingClientRect();if(l&&on(l.top,l.bottom,J())&&on(l.left,l.right,Y())){if(b().sendLatencyMetric({latencyMetricType:Ee,placementId:a,placementName:n,placementDivId:i,timestamp:new Date}),e[o].loaded){b().sendLatencyMetric({latencyMetricType:Te,placementId:a,placementName:n,placementDivId:i,timestamp:new Date});const e={id:a,name:n};H("adplacements:htmlviewed:loaded:",e),H("adplacements:htmlviewed",e)}t.viewed=!0,c=t.tracker,window.removeEventListener("scroll",c),window.removeEventListener("resize",c),document.removeEventListener("visibilitychange",c)}var c},rn=(e,t,i,n,a)=>{if(!e[a]){e[a]={valid:!1};try{const o=e[a];sn(e,o,t,i,n,a);const s=k(S(20,(()=>{sn(e,o,t,i,n,a)})),u);Ce(s),o.tracker=s,o.valid=!0}catch(o){throw u("Error initializing viewable latency instrumentation",o),o}}},dn=()=>({saveActivePlacement:e=>{window.adReporter.activePlacementDivId=e.id},getPlacements:()=>Array.from(document.getElementsByClassName("text/x-dacx-safeframe")).map((e=>e)),getConfig:()=>window.adReporter.config,getPlacementConfig:e=>window.adReporter[e.id].config,getAdDetails:()=>window.adReporter[window.adReporter.activePlacementDivId].adDetails,saveAdDetails:e=>{var t,i;return window.adReporter=null!==(t=window.adReporter)&&void 0!==t?t:{},window.adReporter[e.adUnitPlacementId]=null!==(i=window.adReporter[e.adUnitPlacementId])&&void 0!==i?i:{},window.adReporter[e.adUnitPlacementId].adDetails=e}});class ln{constructor(e,t,i,n){this.hc=e,this.hms=t,this.hmr=i,this.supportedCommands=n,this.initializeAdIds=e=>{var t,i,n;this.hc.AD_IDS[e.arid]=(i=(t=e).placementName,n=R(t),{slotId:i,wrapperDivId:`ape_${n}_wrapper`,placementDivId:`ape_${n}_placement`,iframeId:`ape_${n}_iframe`,textDivWrapperId:`ape_${n}_text-wrapper`,textDivId:`ape_${n}_text`,auiCardDeckId:`ape_${n}_aui_cardDeck`})},this.initializeAdMap=(e,t)=>{try{const i=document.getElementById(this.hc.AD_IDS[e.arid].placementDivId),n=this.hc.AD_IDS[e.arid].iframeId,a=document.getElementById(n);this.hc.adMap[e.arid]={placement:i,iframe:a,options:e,messagePort:t,hasTransferredMessagePort:!1}}catch(i){u(`Error creating safeFrame ${e.slotName}`,i)}},this.initAllSafeFrames=async()=>{var e,t;null===(t=performance)||void 0===t||null===(e=t.mark)||void 0===e||e.call(t,"SafeFrame: Start initAllSafeFrames"),this.getWindowSafeFrame()||(this.initWindowSafeFrame({registerCustomMessageListener:this.hms.registerCustomMessageListener,sendCustomMessage:this.hms.sendCustomMessage,secondPhaseLoadAd:this.secondPhaseLoadAd}),Je(),un(this.getWindowSafeFrame()))},this.secondPhaseLoadAd=async(e,t,i,n,a)=>{var o,s;null===(s=performance)||void 0===s||null===(o=s.mark)||void 0===o||o.call(s,`SafeFrame: Start secondPhaseLoadAd ${t.adUnitPlacementId}`),this.initializeAdIds(t),this.initializeAdMap(t,i);const r=this.hc,d=this.hms,l=this.hc.adMap[e].options;dn().saveAdDetails(l),an(r,l),pn(r,d,l);const c=ft(l);ct().isT1()&&c.resize(t.size),fn(t),vn(c);const m=this.hc.AD_IDS[e];if(rn(r.viewableLatencyTrackers,m.placementDivId,m.slotId,c.id,e),l.forcePunt)return Ci("forcePunt",c),ze({forcePunt:"true"}),void c.collapse();mn(l),wn(c,m.placementDivId,n,a),H("adload:delayloadcallback",c),Ne("adload_delayload",c);try{await Ai(l)?(cn(r,l,this.hmr),hn(r,l,d)):c.collapse()}catch(p){throw c.collapse(),p}}}}const cn=(e,t,i)=>{e.adMap[t.arid].messagePort.onmessage=i.receiveMessage},mn=e=>{b().sendLatencyMetric({latencyMetricType:Ae,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId}),H(Vi,{id:e.placementId,name:e.placementName}),F(Vi),Ne("adload_start",{id:e.placementId,name:e.placementName})},pn=(e,t,i)=>{e.ADS_HANDLERS[i.arid]=e.ADS_HANDLERS[i.arid]||{},e.ADS_HANDLERS[i.arid].defaultResizeSafeFrameHandler=()=>{et(i.arid,i.size.width,i.size.height,i.maxAdWidth,t,e.AD_IDS)},e.ADS_HANDLERS[i.arid].defaultSetResizePlacementStyle=()=>{i.resizePlacementStyle&&tt(i.arid,e.AD_IDS,i.resizePlacementStyle)}},hn=(e,t,i)=>{Gi(t)},un=e=>{window.addEventListener("resize",(()=>{null==e||e.sendCustomMessage("resize",{height:window.innerHeight,width:window.innerWidth})}))},wn=(e,t,i,n)=>{var a,o;i&&(d({latencyEvent:"wb",placement:e,timestamp:i}),d({latencyEvent:"bb",placement:e,timestamp:i}));const s=null===(o=document)||void 0===o||null===(a=o.getElementById)||void 0===a?void 0:a.call(o,t);n&&null!==s&&g(s,"bodyBegin",n)},fn=e=>{F("resize:size:request"),e.creative.size?e.creative.size.height===parseInt(e.size.height)&&e.creative.size.width===parseInt(e.size.width)||F("resize:size:differ"):F("resize:size:missing")},vn=e=>{try{H("coordinate:x",e,e.div.getBoundingClientRect().x),H("coordinate:y",e,e.div.getBoundingClientRect().y)}catch(t){return}},gn="custommessage:notallowlisted";class yn{constructor(e,t={}){this.adMap=e,this.msgListeners=t,this.sendMessageToAd=(e,t,i)=>{const n={command:t,data:i};this.adMap[e].messagePort.postMessage(n)},this.customMessage=(e,t,i,n,a)=>{const o=this.msgListeners;try{"undefined"!==i&&Array.isArray(i)&&(i.indexOf(e)>-1&&o[e]?(F(`custommessage:allowlisted:${e}`),o[e](t)):-1===i.indexOf(e)?(F(gn),H(gn,{id:a,name:n})):u("Unrecognized custom message key: "+e))}catch(s){u("Custom Message Error",s)}},this.registerCustomMessageListener=(e,t,i)=>{let n=!1;const a=this.msgListeners;try{if(!a[e]||"function"!=typeof a[e]||i)a[e]=t,n=!0;else{const t=new Error("Custom message listener already exists for key: "+e);u("Duplicate Key",t)}}catch(o){u("Error registering custom message listener",o)}return n},this.sendCustomMessage=(e,t)=>{const i=this.adMap,n={key:e,data:t};for(const a in i)this.sendMessageToAd(a,"customMessage",n)},this.sendCustomMessageToAd=(e,t,i)=>{const n={key:t,data:i};this.sendMessageToAd(e,"customMessage",n)}}}class bn{constructor(e={},t={},i={},n={},a={}){this.adMap=e,this.ADS_HANDLERS=t,this.AD_IDS=i,this.AD_TRACERS=n,this.viewableLatencyTrackers=a}}class In{constructor(e={},t){this.adMap=e,this.supportedCommands=t,this.receiveMessage=async e=>{const t=this.adMap,i=e.data,n=t[i.arid];try{const e=this.supportedCommands[i.command];e&&await e(n,i.data)}catch(a){const t="Problem with message: "+JSON.stringify(e.data);u(t,a)}}}}var Sn,An;null===(An=performance)||void 0===An||null===(Sn=An.mark)||void 0===Sn||Sn.call(An,"SafeFrame: SafeFrame: Starting DAsf");const En=new bn,Tn=new yn(null==En?void 0:En.adMap),Mn=new class extends ln{constructor(e=new bn,t=new yn(e.adMap)){const i=new ji(t,e);super(e,t,new In(e.adMap,i),i),this.initWindowSafeFrame=e=>{window.DAsf=e},this.getWindowSafeFrame=()=>window.DAsf}}(En,Tn);k((()=>Mn.initAllSafeFrames()),u,"Error initializing safeFrame")()})();
//# sourceMappingURL=DAsf-1.50.9fb2999a.js.map
